name: Holiday deals email

on:
  schedule:
    - cron: "0 7 * * *" # 7am UTC every day
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      APP_BASE_URL: ${{ secrets.APP_BASE_URL }}
      CRON_SECRET: ${{ secrets.CRON_SECRET }}
    steps:
      - name: Call email endpoint
        run: |
          URL="${APP_BASE_URL%/}/api/alerts/email"
          echo "Calling: $URL"

          curl -sS -L --fail-with-body \
            -X POST "$URL" \
            -H "x-cron-secret: $CRON_SECRET" \
            -H "content-type: application/json" \
            -d '{}' \
            -w "\nHTTP %{http_code}\n"
